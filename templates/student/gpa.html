{% extends "base.html" %} {% block title %}My GPA - Course Tracker{% endblock %}
{% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/components.css') }}"
/>
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/theme-student.css') }}"
/>
<link rel="stylesheet" href="{{ url_for('static', filename='css/gpa.css') }}" />
{% endblock %} {% block content %}
<div class="page-header">
  <h1>My GPA Dashboard</h1>
  <p>Your weighted GPA based on completed courses</p>
  <span class="sql-badge">QUERY: JOIN, AGGREGATION, & CASE</span>
  <span class="sql-badge">VIEW</span>
</div>

<div class="query-description">
  <h3>Query Description</h3>
  <p>
    This dashboard calculates your weighted GPA using multiple SQL concepts:
  </p>
  <ul>
    <li>
      <strong>JOIN</strong> across <code>Student</code>,
      <code>enrolls_in</code>, and <code>Course</code> tables
    </li>
    <li>
      <strong>AGGREGATION</strong> using <code>SUM()</code> to calculate
      weighted grade points
    </li>
    <li><strong>GROUP BY</strong> to aggregate data for your student record</li>
    <li>
      <strong>CASE</strong> statement to convert letter grades to grade points
      (A+ = 4.33, A = 4.0, etc.)
    </li>
  </ul>
  <p style="margin-bottom: 0; margin-top: 1rem">
    <strong>Formula:</strong> GPA = SUM(grade_points x credits) / SUM(credits)
    for all completed courses
  </p>
</div>

{% if student_data %}
<div class="gpa-card">
  <div class="gpa-display">
    {% set gpa = student_data.gpa|float %}
    <p style="color: #ffcd00; margin: 0; font-size: 1.2rem">Current GPA</p>
    {% if gpa >= 3.7 %}
    <p class="gpa-value gpa-excellent">{{ "%.2f"|format(gpa) }}</p>
    <p style="color: #4caf50; margin: 0">Excellent Performance</p>
    {% elif gpa >= 3.0 %}
    <p class="gpa-value gpa-good">{{ "%.2f"|format(gpa) }}</p>
    <p style="color: #8bc34a; margin: 0">Good Performance</p>
    {% elif gpa >= 2.5 %}
    <p class="gpa-value gpa-average">{{ "%.2f"|format(gpa) }}</p>
    <p style="color: #ffc107; margin: 0">Average Performance</p>
    {% elif gpa >= 2.0 %}
    <p class="gpa-value gpa-fair">{{ "%.2f"|format(gpa) }}</p>
    <p style="color: #ff9800; margin: 0">Fair Performance</p>
    {% else %}
    <p class="gpa-value gpa-poor">{{ "%.2f"|format(gpa) }}</p>
    <p style="color: #f44336; margin: 0">Needs Improvement</p>
    {% endif %}
  </div>

  <div class="stats-grid">
    <div class="stat-box">
      <p class="stat-label">Student ID</p>
      <p class="stat-value">{{ student_data.studentId }}</p>
    </div>
    <div class="stat-box">
      <p class="stat-label">Courses Completed</p>
      <p class="stat-value">{{ student_data.courses_completed }}</p>
    </div>
    <div class="stat-box">
      <p class="stat-label">Total Credits</p>
      <p class="stat-value">{{ student_data.total_credits }}</p>
    </div>
  </div>
</div>

{% if completed_courses %}
<div class="content-card">
  <h2>Completed Courses</h2>
  <table class="data-table">
    <thead>
      <tr>
        <th>Course</th>
        <th>Code</th>
        <th>Credits</th>
        <th>Grade</th>
        <th>Completed Date</th>
      </tr>
    </thead>
    <tbody>
      {% for course in completed_courses %}
      <tr>
        <td class="cell-title">{{ course.title }}</td>
        <td>
          <span class="id-badge">
            {% if course.code and ',' in course.code %} ({{ course.code }}) {%-
            else -%} {{ course.code or course.courseId }} {%- endif -%} :{{
            course.sectionNo }}
          </span>
        </td>
        <td><span class="credits-badge">{{ course.credits }} credits</span></td>
        <td>
          <span class="grade-badge grade-{{ course.grade[0]|lower }}"
            >{{ course.grade }}</span
          >
        </td>
        <td>{{ course.enrolledDate }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <div class="info-box">
    <h4>Database View</h4>
    <p>
      This table is populated using the
      <code>completed_student_courses</code> database view, which joins
      <code>Student</code>, <code>enrolls_in</code>, <code>Section</code>, and
      <code>Course</code> tables to display all completed courses with credits,
      grades, and completion dates.
    </p>
  </div>
</div>
{% endif %} {% else %}
<div class="empty-state">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
    />
  </svg>
  <h3>No GPA Data Available</h3>
  <p>You haven't completed any courses with grades yet.</p>
  <p style="margin-top: 1rem">
    <a
      href="{{ url_for('student.enroll') }}"
      style="color: #1976d2; font-weight: 600"
      >Enroll in courses</a
    >
    to start building your academic record.
  </p>
</div>
{% endif %} {% endblock %}
