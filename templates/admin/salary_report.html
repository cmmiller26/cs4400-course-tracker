{% extends "base.html" %} {% block title %}Salary Report - Admin Portal{%
endblock %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/components.css') }}"
/>
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/theme-admin.css') }}"
/>
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/salary_report.css') }}"
/>
{% endblock %} {% block content %}
<div class="page-header">
  <h1>Employee Salary Analysis Report</h1>
  <p>Comprehensive salary comparison using subqueries and stored functions</p>
  <span class="sql-badge">QUERY: SUBQUERY, AGGREGATION, & JOIN</span>
  <span class="sql-badge">FUNCTION</span>
</div>

<!-- Section 1: Employee Salary vs Role Average -->
<div class="section-header">
  <h2>Employee Salaries vs Role Average</h2>
</div>

<div class="query-description">
  <h3>SQL Concepts Used</h3>
  <p>This analysis demonstrates the following SQL concepts:</p>
  <ul>
    <li>
      <strong>SUBQUERY:</strong> A nested <code>SELECT</code> statement
      calculates the average salary for each role. This subquery is treated like
      a temporary table.
    </li>
    <li>
      <strong>AGGREGATION:</strong> The <code>AVG()</code> function is used
      within the subquery with <code>GROUP BY role</code> to compute the average
      salary for each distinct role.
    </li>
    <li>
      <strong>JOIN:</strong> The main <code>Employee</code> table is joined with
      the results of the subquery on the <code>role</code> column to compare
      each employee's salary against their role's average.
    </li>
  </ul>
</div>

{% if employees %}
<div class="result-count">
  <strong>{{ employees|length }}</strong> employees analyzed
</div>

<table class="data-table">
  <thead>
    <tr>
      <th>Role</th>
      <th>Employee ID</th>
      <th>Name</th>
      <th>Salary</th>
      <th>Role Average</th>
      <th>Difference</th>
    </tr>
  </thead>
  <tbody>
    {% for emp in employees %}
    <tr>
      <td>
        {% if emp.role|lower == 'professor' %}
        <span class="role-badge role-professor">{{ emp.role }}</span>
        {% elif emp.role|lower == 'ta' %}
        <span class="role-badge role-ta">{{ emp.role }}</span>
        {% elif emp.role|lower == 'advisor' %}
        <span class="role-badge role-advisor">{{ emp.role }}</span>
        {% else %}
        <span class="role-badge">{{ emp.role }}</span>
        {% endif %}
      </td>
      <td><span class="id-badge">{{ emp.employeeId }}</span></td>
      <td class="cell-title">{{ emp.name }}</td>
      <td>${{ "{:,.2f}".format(emp.salary) }}</td>
      <td>${{ "{:,.2f}".format(emp.average_salary) }}</td>
      <td>
        {% set diff = emp.difference %} {% if diff > 0 %}
        <span class="salary-positive">+${{ "{:,.2f}".format(diff) }}</span>
        {% elif diff < 0 %}
        <span class="salary-negative">-${{ "{:,.2f}".format(diff|abs) }}</span>
        {% else %}
        <span class="salary-neutral">$0.00</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<div class="empty-state">
  <h3>No Employee Data Available</h3>
</div>
{% endif %}

<!-- Section 2: Department Average Salaries -->
<div class="section-header">
  <h2>Department Average Salaries</h2>
</div>

<div class="query-description">
  <h3>SQL Concept Used</h3>
  <p>This analysis demonstrates a powerful database feature:</p>
  <ul>
    <li>
      <strong>STORED FUNCTION:</strong> The Python backend calls the custom SQL
      function <code>average_department_salary(deptId)</code> for each
      department. This function encapsulates the logic to calculate and return
      the average salary for a given department ID, promoting code reuse and
      abstraction.
    </li>
  </ul>
</div>

{% if department_averages %}
<div class="result-count">
  <strong>{{ department_averages|length }}</strong> departments analyzed
</div>

<table class="data-table">
  <thead>
    <tr>
      <th>Department ID</th>
      <th>Department Name</th>
      <th>Average Salary</th>
    </tr>
  </thead>
  <tbody>
    {% for dept in department_averages %}
    <tr>
      <td><span class="id-badge">{{ dept.deptId }}</span></td>
      <td class="cell-title">{{ dept.name }}</td>
      <td>
        {% if dept.average_salary %} ${{ "{:,.2f}".format(dept.average_salary)
        }} {% else %}
        <span class="cell-muted">No employees</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<div class="empty-state">
  <h3>No Department Data Available</h3>
</div>
{% endif %} {% endblock %}
