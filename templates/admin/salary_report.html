{% extends "base.html" %} {% block title %}Salary Report - Admin Portal{%
endblock %} {% block extra_css %}
<style>
  .page-header {
    background: linear-gradient(135deg, #000 0%, #333 100%);
    color: #ffcd00;
    padding: 2rem;
    border-radius: 10px;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .page-header h1 {
    margin: 0 0 0.5rem 0;
    font-size: 2rem;
  }

  .page-header p {
    margin: 0;
    opacity: 0.9;
    font-size: 1rem;
  }

  .sql-badge {
    display: inline-block;
    background: #ffcd00;
    color: #000;
    padding: 0.3rem 0.8rem;
    border-radius: 5px;
    font-size: 0.85rem;
    font-weight: bold;
    margin-top: 0.5rem;
    margin-right: 0.5rem;
  }

  .section-header {
    background: #f5f5f5;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    margin: 2rem 0 1rem 0;
    border-left: 4px solid #ffcd00;
  }

  .section-header h2 {
    margin: 0;
    color: #000;
    font-size: 1.5rem;
  }

  .data-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
    background: white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    overflow: hidden;
  }

  .data-table thead {
    background: #000;
    color: #ffcd00;
  }

  .data-table th {
    padding: 1rem;
    text-align: left;
    font-weight: bold;
    border-bottom: 2px solid #ffcd00;
  }

  .data-table td {
    padding: 1rem;
    border-bottom: 1px solid #e0e0e0;
  }

  .data-table tbody tr:nth-child(even) {
    background-color: #f9f9f9;
  }

  .data-table tbody tr:hover {
    background-color: #fff8e1;
    transition: background-color 0.3s ease;
  }

  .salary-positive {
    color: #4caf50;
    font-weight: 600;
  }

  .salary-negative {
    color: #f44336;
    font-weight: 600;
  }

  .salary-neutral {
    color: #666;
    font-weight: 600;
  }

  .role-badge {
    background: #e3f2fd;
    color: #1976d2;
    padding: 0.3rem 0.8rem;
    border-radius: 12px;
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: capitalize;
  }

  .role-professor {
    background: #fff0f0;
    color: #c62828;
  }

  .role-ta {
    background: #e8f5e9;
    color: #2e7d32;
  }

  .role-advisor {
    background: #e3f2fd;
    color: #1565c0;
  }

  /* Fallback for any other roles */
  .role-badge:not(.role-professor):not(.role-ta):not(.role-advisor) {
    background: #f3e5f5;
    color: #6a1b9a;
  }




  .employee-id {
    font-family: monospace;
    background: #f0f0f0;
    padding: 0.2rem 0.5rem;
    border-radius: 3px;
    font-size: 0.9rem;
  }

  .empty-state {
    text-align: center;
    padding: 3rem;
    color: #666;
    background: white;
    border-radius: 8px;
  }

  @media (max-width: 768px) {
    .data-table {
      font-size: 0.9rem;
    }

    .data-table th,
    .data-table td {
      padding: 0.75rem 0.5rem;
    }
  }
</style>
{% endblock %} {% block content %}
<div class="page-header">
  <h1>üí∞ Employee Salary Analysis Report</h1>
  <p>Comprehensive salary comparison using subqueries and stored functions</p>
  <span class="sql-badge">QUERY: SUBQUERY, AGGREGATION, & JOIN</span>
  <span class="sql-badge">FUNCTION</span>
</div>

<!-- Section 1: Employee Salary vs Role Average -->
<div class="section-header">
  <h2>üìä Employee Salaries vs Role Average</h2>
</div>

<div class="query-description" style="
    background: #f5f5f5;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    border-left: 4px solid #000;
  ">
  <h3 style="margin-top: 0">‚öôÔ∏è SQL Concepts Used</h3>
  <p>This analysis demonstrates the following SQL concepts:</p>
  <ul style="margin-left: 2rem; margin-bottom: 0">
    <li>
      <strong>SUBQUERY:</strong> A nested <code>SELECT</code> statement calculates the average salary for each role.
      This subquery is treated like a temporary table.
    </li>
    <li>
      <strong>AGGREGATION:</strong> The <code>AVG()</code> function is used within the subquery with
      <code>GROUP BY role</code> to compute the average salary for each distinct role.
    </li>
    <li>
      <strong>JOIN:</strong> The main <code>Employee</code> table is joined with the results of the subquery on the
      <code>role</code> column to compare each employee's salary against their role's average.
    </li>
  </ul>
</div>

{% if employees %}
<div style="margin-bottom: 1rem; color: #666">
  <strong>{{ employees|length }}</strong> employees analyzed
</div>

<table class="data-table">
  <thead>
    <tr>
      <th>Role</th>
      <th>Employee ID</th>
      <th>Name</th>
      <th>Salary</th>
      <th>Role Average</th>
      <th>Difference</th>
    </tr>
  </thead>
  <tbody>
    {% for emp in employees %}
    <tr>
      <td>
        {% if emp.role|lower == 'professor' %}
        <span class="role-badge role-professor">{{ emp.role }}</span>
        {% elif emp.role|lower == 'ta' %}
        <span class="role-badge role-ta">{{ emp.role }}</span>
        {% elif emp.role|lower == 'advisor' %}
        <span class="role-badge role-advisor">{{ emp.role }}</span>
        {% else %}
        <span class="role-badge">{{ emp.role }}</span>
        {% endif %}
      </td>
      <td><span class="employee-id">{{ emp.employeeId }}</span></td>
      <td style="font-weight: 600">{{ emp.name }}</td>
      <td>${{ "{:,.2f}".format(emp.salary) }}</td>
      <td>${{ "{:,.2f}".format(emp.average_salary) }}</td>
      <td>
        {% set diff = emp.difference %} {% if diff > 0 %}
        <span class="salary-positive">+${{ "{:,.2f}".format(diff) }}</span>
        {% elif diff < 0 %} <span class="salary-negative">-${{ "{:,.2f}".format(diff|abs) }}</span>
          {% else %}
          <span class="salary-neutral">$0.00</span>
          {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<div class="empty-state">
  <h3>No Employee Data Available</h3>
</div>
{% endif %}

<!-- Section 2: Department Average Salaries -->
<div class="section-header">
  <h2>üè¢ Department Average Salaries</h2>
</div>

<div class="query-description" style="
    background: #f5f5f5;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    border-left: 4px solid #000;
  ">
  <h3 style="margin-top: 0">‚öôÔ∏è SQL Concept Used</h3>
  <p>This analysis demonstrates a powerful database feature:</p>
  <ul style="margin-left: 2rem; margin-bottom: 0">
    <li>
      <strong>STORED FUNCTION:</strong> The Python backend calls the custom SQL function
      <code>average_department_salary(deptId)</code> for each department. This function encapsulates the logic to
      calculate and return the average salary for a given department ID, promoting code reuse and abstraction.
    </li>
  </ul>
</div>

{% if department_averages %}
<div style="margin-bottom: 1rem; color: #666">
  <strong>{{ department_averages|length }}</strong> departments analyzed
</div>

<table class="data-table">
  <thead>
    <tr>
      <th>Department ID</th>
      <th>Department Name</th>
      <th>Average Salary</th>
    </tr>
  </thead>
  <tbody>
    {% for dept in department_averages %}
    <tr>
      <td><span class="employee-id">{{ dept.deptId }}</span></td>
      <td style="font-weight: 600">{{ dept.name }}</td>
      <td>
        {% if dept.average_salary %} ${{ "{:,.2f}".format(dept.average_salary)
        }} {% else %}
        <span style="color: #999">No employees</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<div class="empty-state">
  <h3>No Department Data Available</h3>
</div>
{% endif %}

{% endblock %}