{% extends "base.html" %} {% block title %}Grade Analytics - Admin Portal{%
endblock %} {% block extra_css %}
<style>
  .page-header {
    background: linear-gradient(135deg, #000 0%, #333 100%);
    color: #ffcd00;
    padding: 2rem;
    border-radius: 10px;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .page-header h1 {
    margin: 0 0 0.5rem 0;
    font-size: 2rem;
  }

  .page-header p {
    margin: 0;
    opacity: 0.9;
    font-size: 1rem;
  }

  .sql-badge {
    display: inline-block;
    background: #ffcd00;
    color: #000;
    padding: 0.3rem 0.8rem;
    border-radius: 5px;
    font-size: 0.85rem;
    font-weight: bold;
    margin-top: 0.5rem;
    margin-right: 0.5rem;
  }

  .section-header {
    background: #f5f5f5;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    margin: 2rem 0 1rem 0;
    border-left: 4px solid #ffcd00;
  }

  .section-header h2 {
    margin: 0;
    color: #000;
    font-size: 1.5rem;
  }

  .data-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
    background: white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    overflow: hidden;
  }

  .data-table thead {
    background: #000;
    color: #ffcd00;
  }

  .data-table th {
    padding: 1rem;
    text-align: left;
    font-weight: bold;
    border-bottom: 2px solid #ffcd00;
  }

  .data-table td {
    padding: 1rem;
    border-bottom: 1px solid #e0e0e0;
  }

  .data-table tbody tr:nth-child(even) {
    background-color: #f9f9f9;
  }

  .data-table tbody tr:hover {
    background-color: #fff8e1;
    transition: background-color 0.3s ease;
  }

  .grade-badge {
    font-size: 1.1rem;
    font-weight: bold;
    padding: 0.3rem 0.8rem;
    border-radius: 8px;
    display: inline-block;
  }

  .grade-excellent {
    background: #4caf50;
    color: white;
  }

  .grade-good {
    background: #8bc34a;
    color: white;
  }

  .grade-average {
    background: #ffc107;
    color: #000;
  }

  .grade-fair {
    background: #ff9800;
    color: white;
  }

  .grade-poor {
    background: #f44336;
    color: white;
  }

  .course-id {
    font-family: monospace;
    background: #f0f0f0;
    padding: 0.2rem 0.5rem;
    border-radius: 3px;
    font-size: 0.9rem;
  }

  .stats-badge {
    background: #e3f2fd;
    color: #1976d2;
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .stats-badge-students {
    background: #e3f2fd;
    color: #1976d2;
  }

  .stats-badge-courses {
    background: #e8f5e9;
    color: #2e7d32;
  }

  .stats-badge:not(.stats-badge-students):not(.stats-badge-courses) {
    background: #f3e5f5;
    /* Fallback color */
    color: #6a1b9a;
  }

  .empty-state {
    text-align: center;
    padding: 3rem;
    color: #666;
    background: white;
    border-radius: 8px;
  }

  @media (max-width: 768px) {
    .data-table {
      font-size: 0.9rem;
    }

    .data-table th,
    .data-table td {
      padding: 0.75rem 0.5rem;
    }
  }
</style>
{% endblock %} {% block content %}
<div class="page-header">
  <h1>üìà Course Grade Analytics</h1>
  <p>Performance analysis using aggregation and database views</p>
  <span class="sql-badge">QUERY: AGGREGATION, CASE & JOIN</span>
  <span class="sql-badge">VIEW</span>
</div>

<!-- Section 1: Average Grade by Course -->
<div class="section-header">
  <h2>üìö Average Grade by Course</h2>
</div>

<div class="query-description" style="
    background: #f5f5f5;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    border-left: 4px solid #000;
  ">
  <h3 style="margin-top: 0">‚öôÔ∏è SQL Concepts Used</h3>
  <p>This analysis demonstrates the following SQL concepts:</p>
  <ul style="margin-left: 2rem; margin-bottom: 0">
    <li>
      <strong>AGGREGATION:</strong> The <code>AVG()</code> and <code>COUNT()</code> functions are used with
      <code>GROUP BY courseId</code> to calculate the average grade and total number of graded students for each course.
    </li>
    <li>
      <strong>CASE Statement:</strong> Converts letter grades (e.g., 'A', 'B-') into numeric grade points (e.g., 4.0,
      2.67) within the <code>AVG()</code> function to enable mathematical calculation.
    </li>
    <li>
      <strong>JOIN:</strong> The <code>Course</code> table is joined with the <code>enrolls_in</code> table to link
      grades to course titles.
    </li>
  </ul>
</div>

{% if course_grades %}
<div style="margin-bottom: 1rem; color: #666">
  <strong>{{ course_grades|length }}</strong> courses analyzed
</div>

<table class="data-table">
  <thead>
    <tr>
      <th>Course ID</th>
      <th>Course Title</th>
      <th>Average Grade</th>
      <th>Students Graded</th>
    </tr>
  </thead>
  <tbody>
    {% for course in course_grades %}
    <tr>
      <td><span class="course-id">{{ course.courseId }}</span></td>
      <td style="font-weight: 600">{{ course.title }}</td>
      <td>
        {% set avg = course.avg_grade|float %} {% if avg >= 3.7 %}
        <span class="grade-badge grade-excellent">{{ "%.2f"|format(avg) }}</span>
        {% elif avg >= 3.0 %}
        <span class="grade-badge grade-good">{{ "%.2f"|format(avg) }}</span>
        {% elif avg >= 2.5 %}
        <span class="grade-badge grade-average">{{ "%.2f"|format(avg) }}</span>
        {% elif avg >= 2.0 %}
        <span class="grade-badge grade-fair">{{ "%.2f"|format(avg) }}</span>
        {% else %}
        <span class="grade-badge grade-poor">{{ "%.2f"|format(avg) }}</span>
        {% endif %}
      </td>
      <td>
        <span class="stats-badge">{{ course.student_count }} students</span>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<div class="empty-state">
  <h3>No Course Grade Data Available</h3>
  <p>No completed courses with grades found.</p>
</div>
{% endif %}

<!-- Section 2: Average Grade by Professor -->
<div class="section-header">
  <h2>üë®‚Äçüè´ Average Grade by Professor</h2>
</div>

<div class="query-description" style="
    background: #f5f5f5;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    border-left: 4px solid #000;
  ">
  <h3 style="margin-top: 0">‚öôÔ∏è SQL Concepts Used</h3>
  <p>This analysis demonstrates a more complex query involving multiple tables:</p>
  <ul style="margin-left: 2rem; margin-bottom: 0">
    <li>
      <strong>Multi-Table JOIN:</strong> Combines data from <code>Professor</code>, <code>Employee</code>,
      <code>teaches</code>, and <code>enrolls_in</code> to link professors to the grades given in the courses they
      teach.
    </li>
    <li>
      <strong>AGGREGATION:</strong> Uses <code>AVG()</code> to calculate the average grade and
      <code>COUNT(DISTINCT)</code> to count unique students and courses, all grouped by professor.
    </li>
  </ul>
</div>

{% if professor_grades %}
<div style="margin-bottom: 1rem; color: #666">
  <strong>{{ professor_grades|length }}</strong> professors analyzed
</div>

<table class="data-table">
  <thead>
    <tr>
      <th>Employee ID</th>
      <th>Professor Name</th>
      <th>Average Grade</th>
      <th>Students Taught</th>
      <th>Courses Taught</th>
    </tr>
  </thead>
  <tbody>
    {% for prof in professor_grades %}
    <tr>
      <td><span class="course-id">{{ prof.employeeId }}</span></td>
      <td style="font-weight: 600">{{ prof.name }}</td>
      <td>
        {% set avg = prof.avg_grade|float %} {% if avg >= 3.7 %}
        <span class="grade-badge grade-excellent">{{ "%.2f"|format(avg) }}</span>
        {% elif avg >= 3.0 %}
        <span class="grade-badge grade-good">{{ "%.2f"|format(avg) }}</span>
        {% elif avg >= 2.5 %}
        <span class="grade-badge grade-average">{{ "%.2f"|format(avg) }}</span>
        {% elif avg >= 2.0 %}
        <span class="grade-badge grade-fair">{{ "%.2f"|format(avg) }}</span>
        {% else %}
        <span class="grade-badge grade-poor">{{ "%.2f"|format(avg) }}</span>
        {% endif %}
      </td>
      <td>
        <span class="stats-badge stats-badge-students">{{ prof.student_count }} students</span>
      </td>
      <td>
        <span class="stats-badge stats-badge-courses">{{ prof.courses_taught }} courses</span>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<div class="empty-state">
  <h3>No Professor Grade Data Available</h3>
  <p>No professors with completed courses found.</p>
</div>
{% endif %}

<!-- Section 3: Completed Courses View -->
<div class="section-header">
  <h2>‚úÖ Completed Student Courses</h2>
</div>

<div class="query-description" style="
    background: #f5f5f5;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    border-left: 4px solid #000;
  ">
  <h3 style="margin-top: 0">‚öôÔ∏è SQL Concept Used</h3>
  <p>This table demonstrates the use of a pre-defined database view:</p>
  <ul style="margin-left: 2rem; margin-bottom: 0">
    <li>
      <strong>DATABASE VIEW:</strong> The data is selected directly from the <code>completed_student_courses</code>
      view. This view encapsulates the complexity of joining multiple tables and filtering for completed courses,
      simplifying the application query to a simple <code>SELECT * FROM completed_student_courses</code>.
    </li>
  </ul>
</div>

{% if completed_courses %}
<div style="margin-bottom: 1rem; color: #666">
  <strong>{{ completed_courses|length }}</strong> completed course records
</div>

<table class="data-table">
  <thead>
    <tr>
      <th>Student ID</th>
      <th>Student Name</th>
      <th>Course Title</th>
      <th>Section</th>
      <th>Grade</th>
      <th>Completion Date</th>
    </tr>
  </thead>
  <tbody>
    {% for course in completed_courses %}
    <tr>
      <td><span class="course-id">{{ course.studentId }}</span></td>
      <td style="font-weight: 600">{{ course.studentName }}</td>
      <td>{{ course.title }}</td>
      <td>{{ course.sectionNo }}</td>
      <td>
        <strong style="color: #1976d2">{{ course.grade }}</strong>
      </td>
      <td>{{ course.enrolledDate }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<div class="empty-state">
  <h3>No Completed Courses</h3>
  <p>No students have completed courses yet.</p>
</div>
{% endif %}

{% endblock %}